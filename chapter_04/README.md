# Рисование линий и дуг

Для создания более сложных визуализаций мы обычно используем **кривые** SVG.
**Кривые** - это самые гибкие из элементов SVG, способные принимать приктически любую форму.
**Форма кривой** SVG **определяется** её атрибутом **d**. Этот **атрибут** содержит строку с последовательностю команд, определяющих **_начальную_** и **_конечную_** точки кривой, **\*типы кривых**, которые используются для изменения направления, и признак замкнутости кривой. Атрибут **d** может быть очень длинным и сложным. Но в большинстве случаев мы не пишем его сами, а используем **генераторы фигур**, имеющиеся в D3!

## Соглашение о границах и отступах

Соглашение о границах и отступах, принятое в D3, определяет общий порядок резервирования пространства вокруг диаграммы для осей меток и легенд. В этом соглашении определяется четыре поля отступов: **_сверху, справа, снизу_** и **_слева_** от диаграммы.
Значения отступов объявляются в объекте с атрибутами **_top, right, bottom_** и **_left_**. Внутри функции **drawLineChart()** объявим константу с именем **margin** и присвоим атрибутам **_top, right, bottom_** и **_left_** значения **_40, 170, 25_** и **_40_** соответственно:

```js
// prettier-ignore
const drawLineChart = (data) => {
  const margin = { top: 40, right: 170, bottom: 25, left: 40 };
  // Определение размера контейнера
  const width = 1000;
  const height = 500;
  const innerWidth = width - margin.right - margin.left;
  const innerHeight = height - margin.top - margin.bottom;
};
```

После определения отступов, можно вычислить размеры так называемой **внутренней диаграммы**.
**Внутренняя диаграмма** - это оставшиеся пространство в контейнере SVG для ядра диаграммы.
Создадим в методе **drawLineChart()** две константы: ширину (**innerWidth**) и высоту (**innerHeight**) внутренней диаграммы:

```js
// prettier-ignore
const drawLineChart = (data) => {
  const margin = { top: 40, right: 170, bottom: 25, left: 40 };
  // Определение размера контейнера
  const width = 1000;
  const height = 500;
  const innerWidth = width - margin.right - margin.left;
  const innerHeight = height - margin.top - margin.bottom;
};
```

Теперь добавим контейнер SVG для нашей линейной диаграммы. Элемент SVG добавим в **_div_** с идентификатором **line-chart**, и настроим его атрибут **viewBox**, используя константы **width** и **height**.

```js
// prettier-ignore
const svg = d3.select('#line-chart')
  .append("svg")
  .attr("viewBox", `0, 0, ${innerWidth}, ${innerHeight}`);
```

Чтобы реализовать стратегию смещения точки начала координат с учетом заданных отступов, добавим группу в контейнер SVG, применим к ней операцию переноса (**translate(margin.left, margin.top)**), опираясь на размеры отступов слева и сверху, и сохраним группу в константу с именем **innerChart**, которую позднее будем использовать для построения линейной диаграммы:

```js
// prettier-ignore
const innerChart = svg
  .append("g")
  .attr("transform",`translate(${margin.left}, ${margin.top})`);
```

## Генерирование осей

**Оси** - неотъемлемая часть большинства визуализаций данных, играют роль справки для зрителя, чтобы тот мог понять представленные числа и категории.
В D3 оси создаются с помощью генератора компонентов **axis()**. Он принимает шкалу и возвращает элементы SVG, составляющие ось.

### Объявление шкал

Прежде всего нам нужна шкала, располагающая даты по горизонтали. Это действие выполняет **d3.scaleTime()** - шкала времени в D3.
Предметная область шкалы простирается от первой (**_firstDate_**) до последней (**_lastDate_**) даты в наборе данных.
Диапазон шкалы простирается вдоль доступного горизонтального пространства во внутренней диаграмме, т.е от **_0_** до **_innerWidth_**.

```js
// prettier-ignore
const firstDate = d3.min(data, (d) => d.date);
const lastDate = d3.max(data, (d) => d.date);
const xScale = d3
  .scaleTime()
  .domain([firstDate, lastDate])
  .range([0, innerWidth]);
```

Для распределения температур вдоль оси **y** тоже нужна шкала с непрерывным входом и выходом. В данном случае идеально подходит линейная шкала, поскольку нам нужно, чтобы температура и вертикальное положение на линейной диаграмме были линейно пропроциональны.
Следующий фрагмент объявляет температурную шкалу с именем **yScale**. Наша ось **y** должна начинаться с 0, поэтому в качестве минимального значения предметной области мы передаем 0. В качестве максимального предметного значения мы передаем максимальную температу из набора данных. Это значение извлекается из столбца **_max_temp_F_** в наборе данных с помощью функции **d3.max()**.
Диапазон шкалы простирается вдоль доступного вертикального пространства высоты во внутренней диаграмме, а поскольку вертикальные значения вычисляются в системе координат SVG сверху вниз, диапазон начинается с **innerHeight** (позиции нижнего левого угла внутренней диаграммы) и заканчивается 0 (позицией верхнего левого угла):

```js
// prettier-ignore
const maxTemp = d3.max(data, d => d.max_temp_F);
const yScale = d3.scaleLinear().domain([0, maxTemp]).range([innerHeight, 0]);
```
